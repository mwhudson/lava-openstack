metadata:
   name: devstack
   maintainer:
      - Michael Hudson-Doyle <michael.hudson@linaro.org>
   format: "Lava-Test-Shell Test Definition 1.0"
   version: 1.0
   description: ""
   os:
      - ubuntu
   devices:
      - mustang
   environment:
      - lava-test-shell

run:
  steps:
    - "resolvconf -u"
    - "set -x"
    - "export LAVA_SLEEP_FOR_ACCESS LAVA_RUN_TEMPEST LAVA_TESTS_TO_RUN LAVA_SLEEP_DURATION"
    - "apt-get -y install lsb-release git nmap vim pm-utils bridge-utils openssh-server subunit"
    - "git clone -b arm64-trusty git://github.com/mwhudson/testing-openstack"
    - "cd testing-openstack"
    - "./setup.sh"
    - "sleep 60"
    - "sudo -u ubuntu ln -s /opt/stack/tempest /home/ubuntu/tempest"
    - "lava-test-run-attach ~/tempest/etc/tempest.conf"
    - 'if [ "$LAVA_SLEEP_FOR_ACCESS" = "yes" ]; then'
    - '    sleep $LAVA_SLEEP_DURATION'
    - 'fi'

params:
  LAVA_SLEEP_DURATION: 36000
  LAVA_SLEEP_FOR_ACCESS: 'no'

parse:
  pattern: "TEST@(?P<test_case_id>[-0-9A-Za-z_.]+)@ RESULT@(?P<result>[-0-9A-Za-z_.]+)@"
